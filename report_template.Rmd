---
title: "Redoing Activities Checklist Report"
author: "Generated by Meta-Rep Survey Tool"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: 
  pdf_document:
    toc: false
    number_sections: false
    latex_engine: xelatex
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{threeparttable}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{setspace}
  - \usepackage{hyperref}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(knitr)
library(kableExtra)

# Helper function to handle empty values
display_value <- function(value, default = "N/A") {
  if (is.null(value) || value == "") default else value
}

# Extract year from DOI if possible
extract_year <- function(doi) {
  if (is.null(doi) || doi == "") return("")
  year <- regmatches(doi, regexpr("(19|20)\\d{2}", doi))
  if (length(year) > 0) year else ""
}
```

\doublespacing
# Redoing Activities Checklist

This report was automatically generated by the Meta-Rep Survey Tool. The purpose of this classification is to systematically document the nature of redoing studies (replications, reproductions, etc.) to improve transparency in meta-scientific research.
```{r}
cat(paste0(
  "We did a ", display_value(params$RedoingLabel), 
  " of the study ", 
  ifelse(display_value(params$OrigDOI) != "N/A", 
         paste0("(DOI: ", params$OrigDOI, ")"), 
         paste0("titled: \"", display_value(params$OrigTitle), "\"")), ".\n\n",
  
  "Our study is ", 
  ifelse(display_value(params$RegistDOI) == "N/A", 
         "not pre-registered.", 
         paste0("pre-registered (", params$RegistDOI, ").")), "\n\n",
  
  ifelse(display_value(params$PreprintDOI) == "N/A", 
         "", 
         paste0("The preprint can be found at: ", params$PreprintDOI, ".\n\n")),
  
  "The main objectives of our study are: ", display_value(params$Objective), "\n\n",
  
  "This information about the study was created at the ", 
  tolower(display_value(params$Status)), " stage."
))
```
# Changes Summary
```{r}
if (!is.null(params$ratingmatrix_objchanges)) {
  changed_dims <- rownames(params$ratingmatrix_objchanges)[params$ratingmatrix_objchanges$response == "Yes"]
  identical_dims <- rownames(params$ratingmatrix_objchanges)[params$ratingmatrix_objchanges$response == "No"]
  
  cat("We have made at least one change to the following features of the original study: ",
      paste(changed_dims, collapse = ", "), ".\n\n",
      "The following features were kept identical: ",
      paste(identical_dims, collapse = ", "), ".\n\n")
  
  if (!is.null(params$ratingmatrix_intentions)) {
    for (dim in changed_dims) {
      reason <- params$ratingmatrix_intentions[dim, "response"]
      cat(paste0("The changes we made to ", dim, " were ", 
                tolower(reason), ".\n"))
    }
  }
}
```
\newpage
# Receipt: Redoing Activities Checklist

Thank you for using our tool!

```{r}
cat(paste0(
  "DOI/URL for original publication: ", display_value(params$OrigDOI), "\n\n",
  "DOI/URL for redoing publication: ", display_value(params$RedoDOI), "\n\n",
  "DOI/URL for redoing preregistration: ", display_value(params$RegistDOI), "\n\n",
  "DOI/URL for redoing preprint: ", display_value(params$PreprintDOI), "\n\n",
  "The main objectives or research questions of your project are: ", 
  display_value(params$Objective), "\n\n",
  "You would use the following label for your redoing activity: ",
  display_value(params$RedoingLabel), "\n\n",
  "The current status of your project is: ", display_value(params$Status), "\n\n"
))
```

## Reported Changes
```{r}
if (!is.null(params$ratingmatrix_objchanges) && !is.null(params$ratingmatrix_intentions)) {
  # Create combined matrix
  changes_df <- data.frame(
    Dimension = rownames(params$ratingmatrix_objchanges),
    Change = params$ratingmatrix_objchanges$response,
    Reason = params$ratingmatrix_intentions$response
  )
  
  # Format for display
  changes_df$Change[changes_df$Change == "Yes"] <- "X"
  changes_df$Change[changes_df$Change == "No"] <- ""
  
  kable(changes_df, format = "latex", booktabs = TRUE, 
        col.names = c("Dimension", "Changed (X)", "Reason for Change"),
        caption = "Summary of Changes in Redoing Study") %>%
    kable_styling(latex_options = c("striped", "hold_position")) %>%
    column_spec(1, width = "4cm") %>%
    column_spec(2, width = "2cm") %>%
    column_spec(3, width = "4cm")
}
```

\vspace{2cm}
# References
```{r}
refs <- character(0)

if (display_value(params$OrigDOI) != "N/A") {
  refs <- c(refs, paste0("Original study: ", params$OrigDOI))
}

if (display_value(params$RegistDOI) != "N/A") {
  refs <- c(refs, paste0("Pre-registration: ", params$RegistDOI))
}

if (display_value(params$PreprintDOI) != "N/A") {
  refs <- c(refs, paste0("Preprint: ", params$PreprintDOI))
}

if (length(refs) > 0) {
  cat(paste(refs, collapse = "\n\n"))
} else {
  cat("No references available.")
}
```

\vspace{1cm}
# Contact/Feedback

If you have feedback about this tool, please send an email to meta-rep@psy.lmu.de or open an issue in the GitHub repository for our tool: \url{https://github.com/meta-rep/redoing-survey-tool}.

